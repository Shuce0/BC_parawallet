var H=Object.create;var v=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var Q=(e,r)=>{for(var s in r)v(e,s,{get:r[s],enumerable:!0})},S=(e,r,s,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of V(r))!z.call(e,i)&&i!==s&&v(e,i,{get:()=>r[i],enumerable:!(t=J(r,i))||t.enumerable});return e},w=(e,r,s)=>(S(e,r,"default"),s&&S(s,r,"default")),b=(e,r,s)=>(s=e!=null?H(q(e)):{},S(r||!e||!e.__esModule?v(s,"default",{value:e,enumerable:!0}):s,e)),X=e=>S(v({},"__esModule",{value:!0}),e);var u={};Q(u,{Para:()=>P,default:()=>x});module.exports=X(u);w(u,require("@getpara/core-sdk"),module.exports);var F=b(require("@getpara/core-sdk"));var C=class{constructor(){this.localStorage={};this.get=r=>this.localStorage[r]||null;this.set=(r,s)=>{this.localStorage[r]=s};this.removeItem=r=>{delete this.localStorage[r]};this.clear=r=>{let s=Object.keys(this.localStorage);for(let t in s)t&&t.startsWith(r)&&this.removeItem(t)}}};var W=class{constructor(){this.sessionStorage={};this.get=r=>this.sessionStorage[r]||null;this.set=(r,s)=>{this.sessionStorage[r]=s};this.removeItem=r=>{delete this.sessionStorage[r]};this.clear=r=>{let s=Object.keys(this.sessionStorage);for(let t in s)t&&t.startsWith(r)&&this.removeItem(t)}}};var f=b(require("uuid")),y=require("@getpara/core-sdk");var M=require("worker_threads"),h=require("@getpara/core-sdk"),Z=1e3*90,p,K={};function R(e,r){let{timeoutId:s}=K[e];delete K[e],!r&&clearTimeout(s)}async function m(e,r,s){let t=setTimeout(()=>{R(s,!0)},Z);if(K[s]={fn:r,timeoutId:t},!p||!p.threadId){let i=await fetch(`${(0,h.getPortalBaseURL)(e)}/static/js/mpcWorkerServer-bundle.js`);p=new M.Worker(await i.text(),{eval:!0});let n=async o=>{let{workId:a}=o;delete o.workId,await K[a].fn(o),R(a)};p.on("message",n),p.on("error",o=>{throw o}),p.on("exit",o=>{console.error(`worker stopped with exit code ${o}`)})}return p}async function L(e,r,s){return!!(await e.client.getWallets(r)).data.wallets.find(n=>n.id===s).address}async function U(e,r,s,t){return!!(await e.client.getPregenWallets({[s]:[r]})).wallets.find(o=>o.id===t)?.address}function O(e,r,s,t,i=!1,n,o={}){return new Promise(async a=>{let l=f.v4();(await m(e,async d=>{await(0,y.waitUntilTrue)(async()=>L(e,r,d.walletId),15e3,1e3),i&&a({signer:d.signer,walletId:d.walletId,recoveryShare:null})},l)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{userId:r,secretKey:t,type:s},functionType:"KEYGEN",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:n,useDKLS:e.useDKLS,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:l})})}function _(e,r,s,t,i,n=!1,o,a){return new Promise(async l=>{let g=f.v4(),d=await m(e,async T=>{await(0,y.waitUntilTrue)(async()=>U(e,r,s,T.walletId),15e3,1e3),l({signer:T.signer,walletId:T.walletId,recoveryShare:null})},g),E={pregenIdentifier:r,pregenIdentifierType:s,secretKey:i,partnerId:o,email:void 0,type:t};s==="EMAIL"&&(E.email=r),d.postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:E,functionType:"PREKEYGEN",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:a,useDKLS:e.useDKLS,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:g})})}function N(e,r,s,t={}){return new Promise(async i=>{let n=f.v4();(await m(e,async a=>{await(0,y.waitUntilTrue)(async()=>L(e,r,a.walletId),15e3,1e3),i({signer:a.signer,walletId:a.walletId,recoveryShare:null})},n)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{userId:r},functionType:"ED25519_KEYGEN",disableWorkers:e.disableWorkers,sessionCookie:s,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:n})})}function D(e,r,s,t){return new Promise(async i=>{let n=f.v4(),o=await m(e,async g=>{await(0,y.waitUntilTrue)(async()=>U(e,r,s,g.walletId),15e3,1e3),i({signer:g.signer,walletId:g.walletId,recoveryShare:null})},n),l={pregenIdentifier:r,pregenIdentifierType:s,email:void 0};s==="EMAIL"&&(l.email=r),o.postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:l,functionType:"ED25519_PREKEYGEN",disableWorkers:e.disableWorkers,sessionCookie:t,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:n})})}var c=b(require("uuid"));async function A(e,r,s,t,i,n,o,a){return await new Promise(async l=>{let g=c.v4();(await m(e,async k=>{l(k)},g)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{share:t,walletId:s,userId:r,tx:i,chainId:n},functionType:"SIGN_TRANSACTION",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:o,useDKLS:a,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:g})})}async function B(e,r,s,t,i,n,o,a){return await new Promise(async l=>{let g=c.v4();(await m(e,async k=>{l(k)},g)).postMessage({env:e.env,apiKey:e.apiKey,params:{share:t,walletId:s,userId:r,tx:i,chainId:n},functionType:"SEND_TRANSACTION",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:o,useDKLS:a,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:g})})}async function G(e,r,s,t,i,n,o){return await new Promise(async a=>{let l=c.v4();(await m(e,async d=>{a(d)},l)).postMessage({env:e.env,apiKey:e.apiKey,params:{share:t,walletId:s,userId:r,message:i},functionType:"SIGN_MESSAGE",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:n,useDKLS:o,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:l})})}async function Y(e,r,s,t,i,n){return await new Promise(async o=>{let a=c.v4();(await m(e,async g=>{o(g)},a)).postMessage({env:e.env,apiKey:e.apiKey,params:{share:t,walletId:s,userId:r,base64Bytes:i},functionType:"ED25519_SIGN",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:n,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:a})})}var j=b(require("uuid"));async function $(e,r,s,t,i){return await new Promise(async n=>{let o=j.v4();(await m(e,async l=>{n(l)},o)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{share:t,walletId:s,userId:r},functionType:"GET_PRIVATE_KEY",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:i,useDKLS:e.useDKLS,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:o})})}var I=class{constructor(){this.localStorage=new C;this.sessionStorage=new W;this.secureStorage=void 0;this.isSyncStorage=!0;this.disableProviderModal=!0}getPrivateKey(r,s,t,i,n){return $(r,s,t,i,n)}keygen(r,s,t,i,n,o){return O(r,s,t,i,!0,n,o)}refresh(r,s,t,i,n,o,a){throw new Error("not implemented")}preKeygen(r,s,t,i,n,o,a){return _(r,t,i,n,o,!1,s,a)}signMessage(r,s,t,i,n,o,a){return G(r,s,t,i,n,o,a)}signTransaction(r,s,t,i,n,o,a,l){return A(r,s,t,i,n,o,a,l)}sendTransaction(r,s,t,i,n,o,a,l){return B(r,s,t,i,n,o,a,l)}signHash(r,s){throw new Error("not implemented")}ed25519Keygen(r,s,t,i){return N(r,s,t,i)}ed25519PreKeygen(r,s,t,i){return D(r,s,t,i)}ed25519Sign(r,s,t,i,n,o){return Y(r,s,t,i,n,o)}openPopup(r){throw new Error("not implemented")}};var P=class extends F.default{getPlatformUtils(){return new I}};var x=P;0&&(module.exports={Para,...require("@getpara/core-sdk")});
