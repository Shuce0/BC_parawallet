export*from"@getpara/core-sdk";import G from"@getpara/core-sdk";var y=class{constructor(){this.localStorage={};this.get=r=>this.localStorage[r]||null;this.set=(r,s)=>{this.localStorage[r]=s};this.removeItem=r=>{delete this.localStorage[r]};this.clear=r=>{let s=Object.keys(this.localStorage);for(let t in s)t&&t.startsWith(r)&&this.removeItem(t)}}};var c=class{constructor(){this.sessionStorage={};this.get=r=>this.sessionStorage[r]||null;this.set=(r,s)=>{this.sessionStorage[r]=s};this.removeItem=r=>{delete this.sessionStorage[r]};this.clear=r=>{let s=Object.keys(this.sessionStorage);for(let t in s)t&&t.startsWith(r)&&this.removeItem(t)}}};import*as u from"uuid";import{waitUntilTrue as k}from"@getpara/core-sdk";import{Worker as D}from"worker_threads";import{getPortalBaseURL as A}from"@getpara/core-sdk";var B=1e3*90,p,P={};function W(e,r){let{timeoutId:s}=P[e];delete P[e],!r&&clearTimeout(s)}async function m(e,r,s){let t=setTimeout(()=>{W(s,!0)},B);if(P[s]={fn:r,timeoutId:t},!p||!p.threadId){let i=await fetch(`${A(e)}/static/js/mpcWorkerServer-bundle.js`);p=new D(await i.text(),{eval:!0});let n=async o=>{let{workId:a}=o;delete o.workId,await P[a].fn(o),W(a)};p.on("message",n),p.on("error",o=>{throw o}),p.on("exit",o=>{console.error(`worker stopped with exit code ${o}`)})}return p}async function K(e,r,s){return!!(await e.client.getWallets(r)).data.wallets.find(n=>n.id===s).address}async function I(e,r,s,t){return!!(await e.client.getPregenWallets({[s]:[r]})).wallets.find(o=>o.id===t)?.address}function T(e,r,s,t,i=!1,n,o={}){return new Promise(async a=>{let l=u.v4();(await m(e,async d=>{await k(async()=>K(e,r,d.walletId),15e3,1e3),i&&a({signer:d.signer,walletId:d.walletId,recoveryShare:null})},l)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{userId:r,secretKey:t,type:s},functionType:"KEYGEN",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:n,useDKLS:e.useDKLS,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:l})})}function E(e,r,s,t,i,n=!1,o,a){return new Promise(async l=>{let g=u.v4(),d=await m(e,async b=>{await k(async()=>I(e,r,s,b.walletId),15e3,1e3),l({signer:b.signer,walletId:b.walletId,recoveryShare:null})},g),C={pregenIdentifier:r,pregenIdentifierType:s,secretKey:i,partnerId:o,email:void 0,type:t};s==="EMAIL"&&(C.email=r),d.postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:C,functionType:"PREKEYGEN",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:a,useDKLS:e.useDKLS,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:g})})}function R(e,r,s,t={}){return new Promise(async i=>{let n=u.v4();(await m(e,async a=>{await k(async()=>K(e,r,a.walletId),15e3,1e3),i({signer:a.signer,walletId:a.walletId,recoveryShare:null})},n)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{userId:r},functionType:"ED25519_KEYGEN",disableWorkers:e.disableWorkers,sessionCookie:s,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:n})})}function M(e,r,s,t){return new Promise(async i=>{let n=u.v4(),o=await m(e,async g=>{await k(async()=>I(e,r,s,g.walletId),15e3,1e3),i({signer:g.signer,walletId:g.walletId,recoveryShare:null})},n),l={pregenIdentifier:r,pregenIdentifierType:s,email:void 0};s==="EMAIL"&&(l.email=r),o.postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:l,functionType:"ED25519_PREKEYGEN",disableWorkers:e.disableWorkers,sessionCookie:t,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:n})})}import*as w from"uuid";async function h(e,r,s,t,i,n,o,a){return await new Promise(async l=>{let g=w.v4();(await m(e,async f=>{l(f)},g)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{share:t,walletId:s,userId:r,tx:i,chainId:n},functionType:"SIGN_TRANSACTION",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:o,useDKLS:a,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:g})})}async function L(e,r,s,t,i,n,o,a){return await new Promise(async l=>{let g=w.v4();(await m(e,async f=>{l(f)},g)).postMessage({env:e.env,apiKey:e.apiKey,params:{share:t,walletId:s,userId:r,tx:i,chainId:n},functionType:"SEND_TRANSACTION",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:o,useDKLS:a,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:g})})}async function U(e,r,s,t,i,n,o){return await new Promise(async a=>{let l=w.v4();(await m(e,async d=>{a(d)},l)).postMessage({env:e.env,apiKey:e.apiKey,params:{share:t,walletId:s,userId:r,message:i},functionType:"SIGN_MESSAGE",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:n,useDKLS:o,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:l})})}async function O(e,r,s,t,i,n){return await new Promise(async o=>{let a=w.v4();(await m(e,async g=>{o(g)},a)).postMessage({env:e.env,apiKey:e.apiKey,params:{share:t,walletId:s,userId:r,base64Bytes:i},functionType:"ED25519_SIGN",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:n,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:a})})}import*as _ from"uuid";async function N(e,r,s,t,i){return await new Promise(async n=>{let o=_.v4();(await m(e,async l=>{n(l)},o)).postMessage({env:e.env,apiKey:e.apiKey,cosmosPrefix:e.cosmosPrefix,params:{share:t,walletId:s,userId:r},functionType:"GET_PRIVATE_KEY",offloadMPCComputationURL:e.offloadMPCComputationURL,disableWorkers:e.disableWorkers,sessionCookie:i,useDKLS:e.useDKLS,disableWebSockets:e.disableWebSockets,wasmOverride:e.wasmOverride,workId:o})})}var S=class{constructor(){this.localStorage=new y;this.sessionStorage=new c;this.secureStorage=void 0;this.isSyncStorage=!0;this.disableProviderModal=!0}getPrivateKey(r,s,t,i,n){return N(r,s,t,i,n)}keygen(r,s,t,i,n,o){return T(r,s,t,i,!0,n,o)}refresh(r,s,t,i,n,o,a){throw new Error("not implemented")}preKeygen(r,s,t,i,n,o,a){return E(r,t,i,n,o,!1,s,a)}signMessage(r,s,t,i,n,o,a){return U(r,s,t,i,n,o,a)}signTransaction(r,s,t,i,n,o,a,l){return h(r,s,t,i,n,o,a,l)}sendTransaction(r,s,t,i,n,o,a,l){return L(r,s,t,i,n,o,a,l)}signHash(r,s){throw new Error("not implemented")}ed25519Keygen(r,s,t,i){return R(r,s,t,i)}ed25519PreKeygen(r,s,t,i){return M(r,s,t,i)}ed25519Sign(r,s,t,i,n,o){return O(r,s,t,i,n,o)}openPopup(r){throw new Error("not implemented")}};var v=class extends G{getPlatformUtils(){return new S}};var ue=v;export{v as Para,ue as default};
